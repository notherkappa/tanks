//---------------------------------------------------------------------------

#include <vcl.h>
#pragma hdrstop

#include "mapCreator.h"
//---------------------------------------------------------------------------
#pragma package(smart_init)
#pragma resource "*.dfm"
TForm2 *Form2;
//---------------------------------------------------------------------------
__fastcall TForm2::TForm2(TComponent* Owner)
        : TForm(Owner)
{
}
//---------------------------------------------------------------------------
void __fastcall TForm2::buildEditorInterface()
{
        Defines d;
        d.Load("maps\\mapeditor.cfg");
        TStringList * objects = d.GetList("objects");
        for (int i=0; i<objects->Count; i++)
        {
                TImage * img = new TImage(this);
                img->Parent = GroupBox1;
                Defines sp;

                sp.Load("sprites\\"+d.Get("objects."+objects->Strings[i]+".sprite"));

                String filespr ="sprites\\res\\"+sp.Get("registername")+".sprite\\"+sp.Get("spritesrc");
                img->Picture->LoadFromFile(filespr);
                img->Tag = i+1;
                img->Left = (i%4)*32+4;
                img->Top = (i/4)*32+16;
                img->Width=StrToInt(sp.Get("w"));
                img->Height=StrToInt(sp.Get("h"));
                img->OnClick = PaletteClick;
        }
}
//---------------------------------------------------------------------------
void __fastcall TForm2::FormActivate(TObject *Sender)
{
        buildEditorInterface();
}
//---------------------------------------------------------------------------
void __fastcall TForm2::PaletteClick(TObject *Sender)
{
        pickedItem = ((TImage*)Sender)->Tag;
}
//---------------------------------------------------------------------------
void __fastcall TForm2::GroupBox1Click(TObject *Sender)
{
        pickedItem=0;        
}
//---------------------------------------------------------------------------
